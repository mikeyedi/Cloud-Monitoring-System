groups:
- name: CPU Load
  rules:
  # Alert for any cluster that has average CPU idle < 50%
  - alert: High Usage
    expr: (100 * (1 - sum(rate(node_cpu_seconds_total{mode="idle"}[5m])) by (instance) /sum(rate(node_cpu_seconds_total[5m])) by (instance))) > 60
    for: 1m
    annotations:
     summary: "High usage on {{ $labels.instance }}"
     description: "The instance {{ $labels.instance }}has an average CPU usage {{ $value }}"

- name: System Status
  rules:
   - alert: Instance Down
     expr: up == 0
     for: 1m
     annotations:
      summary: "Instance Down"
      description: "The instance {{ $labels.instance }} {{ $labels.domain }} is down."
- name: Memory Alert
  rules:
    - alert: High Ram Usage
      expr: 1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) > 0.7
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "High RAM Usage"
        description: "RAM usage is above 70%"

- name: Disk Alert
  rules:
    - alert: "Host Out Of Disk Space"
      expr: (node_filesystem_avail_bytes * 100) / node_filesystem_size_bytes < 50 and ON (instance, device, mountpoint) node_filesystem_readonly == 0
      for: 10m
      labels:
        severity: "warning"
      annotations:
        summary: "Host out of disk space (instance {{ $labels.instance }})"
        description: "Disk is almost full (< 10% left)"
        value: "{{ $value }}"
- name: Network Traffic
  rules:
    - alert: High Network Traffic
      expr: (irate(node_network_receive_bytes[1m]) + irate(node_network_transmit_bytes[1m])) > 250e3
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "High Network Traffic"
        description: "{{ $labels.instance }} is experiencing high network traffic"
                                                                                                                                        59,82         Bot
